(function(a,b){if(typeof define==="function"&&define.amd){define(b)}else{if(typeof exports==="object"&&typeof exports.nodeName!=="string"){module.exports=b()}else{a.Croppie=b()}}}(typeof self!=="undefined"?self:this,function(){if(typeof Promise!=="function"){
/*! promise-polyfill 3.1.0 */
;!function(at){function ar(av,au){return function(){av.apply(au,arguments)}}function aq(au){if("object"!==typeof this){throw new TypeError("Promises must be constructed via new")}if("function"!==typeof au){throw new TypeError("not a function")}this._state=null,this._value=null,this._deferreds=[],ak(au,ar(ao,this),ar(an,this))}function ap(av){var au=this;return null===this._state?void this._deferreds.push(av):void ai(function(){var ay=au._state?av.onFulfilled:av.onRejected;if(null===ay){return void (au._state?av.resolve:av.reject)(au._value)}var ax;try{ax=ay(au._value)}catch(aw){return void av.reject(aw)}av.resolve(ax)})}function ao(au){try{if(au===this){throw new TypeError("A promise cannot be resolved with itself.")}if(au&&("object"===typeof au||"function"===typeof au)){var aw=au.then;if("function"===typeof aw){return void ak(ar(aw,au),ar(ao,this),ar(an,this))}}this._state=!0,this._value=au,am.call(this)}catch(av){an.call(this,av)}}function an(au){this._state=!1,this._value=au,am.call(this)}function am(){for(var av=0,au=this._deferreds.length;au>av;av++){ap.call(this,this._deferreds[av])}this._deferreds=null}function al(av,au,ax,aw){this.onFulfilled="function"===typeof av?av:null,this.onRejected="function"===typeof au?au:null,this.resolve=ax,this.reject=aw}function ak(av,au,ay){var ax=!1;try{av(function(az){ax||(ax=!0,au(az))},function(az){ax||(ax=!0,ay(az))})}catch(aw){if(ax){return}ax=!0,ay(aw)}}var aj=setTimeout,ai="function"===typeof setImmediate&&setImmediate||function(au){aj(au,1)},ah=Array.isArray||function(au){return"[object Array]"===Object.prototype.toString.call(au)};aq.prototype["catch"]=function(au){return this.then(null,au)},aq.prototype.then=function(av,au){var aw=this;return new aq(function(ay,ax){ap.call(aw,new al(av,au,ay,ax))})},aq.all=function(){var au=Array.prototype.slice.call(1===arguments.length&&ah(arguments[0])?arguments[0]:arguments);return new aq(function(av,az){function ay(aD,aC){try{if(aC&&("object"===typeof aC||"function"===typeof aC)){var aB=aC.then;if("function"===typeof aB){return void aB.call(aC,function(aE){ay(aD,aE)},az)}}au[aD]=aC,0===--ax&&av(au)}catch(aA){az(aA)}}if(0===au.length){return av([])}for(var ax=au.length,aw=0;aw<au.length;aw++){ay(aw,au[aw])}})},aq.resolve=function(au){return au&&"object"===typeof au&&au.constructor===aq?au:new aq(function(av){av(au)})},aq.reject=function(au){return new aq(function(av,aw){aw(au)})},aq.race=function(au){return new aq(function(av,ay){for(var ax=0,aw=au.length;aw>ax;ax++){au[ax].then(av,ay)}})},aq._setImmediateFn=function(au){ai=au},"undefined"!==typeof module&&module.exports?module.exports=aq:at.Promise||(at.Promise=aq)}(this)}if(typeof window.CustomEvent!=="function"){(function(){function ah(aj,ak){ak=ak||{bubbles:false,cancelable:false,detail:undefined};var ai=document.createEvent("CustomEvent");ai.initCustomEvent(aj,ak.bubbles,ak.cancelable,ak.detail);return ai}ah.prototype=window.Event.prototype;window.CustomEvent=ah}())}if(!HTMLCanvasElement.prototype.toBlob){Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(an,al,am){var aj=atob(this.toDataURL(al,am).split(",")[1]),ai=aj.length,ah=new Uint8Array(ai);for(var ak=0;ak<ai;ak++){ah[ak]=aj.charCodeAt(ak)}an(new Blob([ah],{type:al||"image/png"}))}})}var ac=["Webkit","Moz","ms"],ae=document.createElement("div").style,Z=[1,8,3,6],W=[2,7,4,5],aa,I,m;function p(aj){if(aj in ae){return aj}var ai=aj[0].toUpperCase()+aj.slice(1),ah=ac.length;while(ah--){aj=ac[ah]+ai;if(aj in ae){return aj}}}I=p("transform");aa=p("transformOrigin");m=p("userSelect");function E(ak,aj){var ah=Z.indexOf(ak)>-1?Z:W,ai=ah.indexOf(ak),al=(aj/90)%ah.length;return ah[(ah.length+ai+(al%ah.length))%ah.length]}function R(ah,aj){ah=ah||{};for(var ai in aj){if(aj[ai]&&aj[ai].constructor&&aj[ai].constructor===Object){ah[ai]=ah[ai]||{};R(ah[ai],aj[ai])}else{ah[ai]=aj[ai]}}return ah}function B(ah){return R({},ah)}function h(ai,ak,ah){var aj;return function(){var ao=this,an=arguments;var am=function(){aj=null;if(!ah){ai.apply(ao,an)}};var al=ah&&!aj;clearTimeout(aj);aj=setTimeout(am,ak);if(al){ai.apply(ao,an)}}}function H(ai){if("createEvent" in document){var ah=document.createEvent("HTMLEvents");ah.initEvent("change",false,true);ai.dispatchEvent(ah)}else{ai.fireEvent("onchange")}}function U(ai,aj,ak){if(typeof(aj)==="string"){var ah=aj;aj={};aj[ah]=ak}for(var al in aj){ai.style[al]=aj[al]}}function G(ah,ai){if(ah.classList){ah.classList.add(ai)}else{ah.className+=" "+ai}}function t(ah,ai){if(ah.classList){ah.classList.remove(ai)}else{ah.className=ah.className.replace(ai,"")}}function S(aj,ah){for(var ai in ah){aj.setAttribute(ai,ah[ai])}}function af(ah){return parseInt(ah,10)}function z(ai,aj){var ah=new Image();ah.style.opacity="0";return new Promise(function(am,al){function ak(){ah.style.opacity="1";setTimeout(function(){am(ah)},1)}ah.removeAttribute("crossOrigin");if(ai.match(/^https?:\/\/|^\/\//)){ah.setAttribute("crossOrigin","anonymous")}ah.onload=function(){if(aj){EXIF.getData(ah,function(){ak()})}else{ak()}};ah.onerror=function(an){ah.style.opacity=1;setTimeout(function(){al(an)},1)};ah.src=ai})}function d(aj,am){var ai=aj.naturalWidth;var al=aj.naturalHeight;var ak=am||ag(aj);if(ak&&ak>=5){var ah=ai;ai=al;al=ah}return{width:ai,height:al}}var j={translate3d:{suffix:", 0px"},translate:{suffix:""}};var ad=function(ah,aj,ai){this.x=parseFloat(ah);this.y=parseFloat(aj);this.scale=parseFloat(ai)};ad.parse=function(ah){if(ah.style){return ad.parse(ah.style[I])}else{if(ah.indexOf("matrix")>-1||ah.indexOf("none")>-1){return ad.fromMatrix(ah)}else{return ad.fromString(ah)}}};ad.fromMatrix=function(ah){var ai=ah.substring(7).split(",");if(!ai.length||ah==="none"){ai=[1,0,0,1,0,0]}return new ad(af(ai[4]),af(ai[5]),parseFloat(ai[0]))};ad.fromString=function(aj){var ai=aj.split(") "),al=ai[0].substring(q.globals.translate.length+1).split(","),ak=ai.length>1?ai[1].substring(6):1,ah=al.length>1?al[0]:0,am=al.length>1?al[1]:0;return new ad(ah,am,ak)};ad.prototype.toString=function(){var ah=j[q.globals.translate].suffix||"";return q.globals.translate+"("+this.x+"px, "+this.y+"px"+ah+") scale("+this.scale+")"};var a=function(ai){if(!ai||!ai.style[aa]){this.x=0;this.y=0;return}var ah=ai.style[aa].split(" ");this.x=parseFloat(ah[0]);this.y=parseFloat(ah[1])};a.prototype.toString=function(){return this.x+"px "+this.y+"px"};function ag(ah){return ah.exifdata&&ah.exifdata.Orientation?af(ah.exifdata.Orientation):1}function X(al,ak,aj){var am=ak.width,ah=ak.height,ai=al.getContext("2d");al.width=ak.width;al.height=ak.height;ai.save();switch(aj){case 2:ai.translate(am,0);ai.scale(-1,1);break;case 3:ai.translate(am,ah);ai.rotate(180*Math.PI/180);break;case 4:ai.translate(0,ah);ai.scale(1,-1);break;case 5:al.width=ah;al.height=am;ai.rotate(90*Math.PI/180);ai.scale(1,-1);break;case 6:al.width=ah;al.height=am;ai.rotate(90*Math.PI/180);ai.translate(0,-ah);break;case 7:al.width=ah;al.height=am;ai.rotate(-90*Math.PI/180);ai.translate(-am,ah);ai.scale(1,-1);break;case 8:al.width=ah;al.height=am;ai.translate(0,am);ai.rotate(-90*Math.PI/180);break}ai.drawImage(ak,0,0,am,ah);ai.restore()}function D(){var ap=this,aj="croppie-container",ah=ap.options.viewport.type?"cr-vp-"+ap.options.viewport.type:null,ai,am,an,al,ao,ak;ap.options.useCanvas=ap.options.enableOrientation||w.call(ap);ap.data={};ap.elements={};ai=ap.elements.boundary=document.createElement("div");an=ap.elements.viewport=document.createElement("div");am=ap.elements.img=document.createElement("img");al=ap.elements.overlay=document.createElement("div");if(ap.options.useCanvas){ap.elements.canvas=document.createElement("canvas");ap.elements.preview=ap.elements.canvas}else{ap.elements.preview=am}G(ai,"cr-boundary");ai.setAttribute("aria-dropeffect","none");ao=ap.options.boundary.width;ak=ap.options.boundary.height;U(ai,{width:(ao+(isNaN(ao)?"":"px")),height:(ak+(isNaN(ak)?"":"px"))});G(an,"cr-viewport");if(ah){G(an,ah)}U(an,{width:ap.options.viewport.width+"px",height:ap.options.viewport.height+"px"});an.setAttribute("tabindex",0);G(ap.elements.preview,"cr-image");S(ap.elements.preview,{alt:"preview","aria-grabbed":"false"});G(al,"cr-overlay");ap.element.appendChild(ai);ai.appendChild(ap.elements.preview);ai.appendChild(an);ai.appendChild(al);G(ap.element,aj);if(ap.options.customClass){G(ap.element,ap.options.customClass)}x.call(this);if(ap.options.enableZoom){ab.call(ap)}if(ap.options.enableResize){Q.call(ap)}}function w(){return this.options.enableExif&&window.EXIF}function Q(){var au=this;var ai=document.createElement("div");var al=false;var am;var at;var an;var ah=50;var ar;var aq;var av;var ap;G(ai,"cr-resizer");U(ai,{width:this.options.viewport.width+"px",height:this.options.viewport.height+"px"});if(this.options.resizeControls.height){av=document.createElement("div");G(av,"cr-resizer-vertical");ai.appendChild(av)}if(this.options.resizeControls.width){ap=document.createElement("div");G(ap,"cr-resizer-horisontal");ai.appendChild(ap)}function aj(ax){if(ax.button!==undefined&&ax.button!==0){return}ax.preventDefault();if(al){return}var aw=au.elements.overlay.getBoundingClientRect();al=true;at=ax.pageX;an=ax.pageY;am=ax.currentTarget.className.indexOf("vertical")!==-1?"v":"h";ar=aw.width;aq=aw.height;if(ax.touches){var ay=ax.touches[0];at=ay.pageX;an=ay.pageY}window.addEventListener("mousemove",ao);window.addEventListener("touchmove",ao);window.addEventListener("mouseup",ak);window.addEventListener("touchend",ak);document.body.style[m]="none"}function ao(aC){var aA=aC.pageX;var az=aC.pageY;aC.preventDefault();if(aC.touches){var aD=aC.touches[0];aA=aD.pageX;az=aD.pageY}var ay=aA-at;var aw=az-an;var ax=au.options.viewport.height+aw;var aB=au.options.viewport.width+ay;if(am==="v"&&ax>=ah&&ax<=aq){U(ai,{height:ax+"px"});au.options.boundary.height+=aw;U(au.elements.boundary,{height:au.options.boundary.height+"px"});au.options.viewport.height+=aw;U(au.elements.viewport,{height:au.options.viewport.height+"px"})}else{if(am==="h"&&aB>=ah&&aB<=ar){U(ai,{width:aB+"px"});au.options.boundary.width+=ay;U(au.elements.boundary,{width:au.options.boundary.width+"px"});au.options.viewport.width+=ay;U(au.elements.viewport,{width:au.options.viewport.width+"px"})}}K.call(au);o.call(au);T.call(au);C.call(au);an=az;at=aA}function ak(){al=false;window.removeEventListener("mousemove",ao);window.removeEventListener("touchmove",ao);window.removeEventListener("mouseup",ak);window.removeEventListener("touchend",ak);document.body.style[m]=""}if(av){av.addEventListener("mousedown",aj);av.addEventListener("touchstart",aj)}if(ap){ap.addEventListener("mousedown",aj);ap.addEventListener("touchstart",aj)}this.elements.boundary.appendChild(ai)}function P(ah){if(this.options.enableZoom){var aj=this.elements.zoomer,ai=O(ah,4);aj.value=Math.max(parseFloat(aj.min),Math.min(parseFloat(aj.max),ai)).toString()}}function ab(){var ai=this,aj=ai.elements.zoomerWrap=document.createElement("div"),ak=ai.elements.zoomer=document.createElement("input");G(aj,"cr-slider-wrap");G(ak,"cr-slider");ak.type="range";ak.step="0.0001";ak.value="1";ak.style.display=ai.options.showZoomer?"":"none";ak.setAttribute("aria-label","zoom");ai.element.appendChild(aj);aj.appendChild(ak);ai._currentZoom=1;function al(){e.call(ai,{value:parseFloat(ak.value),origin:new a(ai.elements.preview),viewportRect:ai.elements.viewport.getBoundingClientRect(),transform:ad.parse(ai.elements.preview)})}function ah(am){var ao,an;if(ai.options.mouseWheelZoom==="ctrl"&&am.ctrlKey!==true){return 0}else{if(am.wheelDelta){ao=am.wheelDelta/1200}else{if(am.deltaY){ao=am.deltaY/1060}else{if(am.detail){ao=am.detail/-60}else{ao=0}}}}an=ai._currentZoom+(ao*ai._currentZoom);am.preventDefault();P.call(ai,an);al.call(ai)}ai.elements.zoomer.addEventListener("input",al);ai.elements.zoomer.addEventListener("change",al);if(ai.options.mouseWheelZoom){ai.elements.boundary.addEventListener("mousewheel",ah);ai.elements.boundary.addEventListener("DOMMouseScroll",ah)}}function e(al){var ap=this,ai=al?al.transform:ad.parse(ap.elements.preview),ak=al?al.viewportRect:ap.elements.viewport.getBoundingClientRect(),am=al?al.origin:new a(ap.elements.preview);function aj(){var aq={};aq[I]=ai.toString();aq[aa]=am.toString();U(ap.elements.preview,aq)}ap._currentZoom=al?al.value:ap._currentZoom;ai.scale=ap._currentZoom;ap.elements.zoomer.setAttribute("aria-valuenow",ap._currentZoom);aj();if(ap.options.enforceBoundary){var ah=u.call(ap,ak),ao=ah.translate,an=ah.origin;if(ai.x>=ao.maxX){am.x=an.minX;ai.x=ao.maxX}if(ai.x<=ao.minX){am.x=an.maxX;ai.x=ao.minX}if(ai.y>=ao.maxY){am.y=an.minY;ai.y=ao.maxY}if(ai.y<=ao.minY){am.y=an.maxY;ai.y=ao.minY}}aj();v.call(ap);C.call(ap)}function u(au){var ar=this,aB=ar._currentZoom,aq=au.width,ah=au.height,an=ar.elements.boundary.clientWidth/2,ak=ar.elements.boundary.clientHeight/2,aA=ar.elements.preview.getBoundingClientRect(),ai=aA.width,az=aA.height,ao=aq/2,at=ah/2;var ax=((ao/aB)-an)*-1;var ay=ax-((ai*(1/aB))-(aq*(1/aB)));var av=((at/aB)-ak)*-1;var aw=av-((az*(1/aB))-(ah*(1/aB)));var ap=(1/aB)*ao;var am=(ai*(1/aB))-ap;var al=(1/aB)*at;var aj=(az*(1/aB))-al;return{translate:{maxX:ax,minX:ay,maxY:av,minY:aw},origin:{maxX:am,minX:ap,maxY:aj,minY:al}}}function T(ap){var ax=this,am=ax._currentZoom,ar=ax.elements.preview.getBoundingClientRect(),ai=ax.elements.viewport.getBoundingClientRect(),aj=ad.parse(ax.elements.preview.style[I]),aw=new a(ax.elements.preview),av=(ai.top-ar.top)+(ai.height/2),ak=(ai.left-ar.left)+(ai.width/2),ah={},au={};if(ap){var an=aw.x;var al=aw.y;var aq=aj.x;var ao=aj.y;ah.y=an;ah.x=al;aj.y=aq;aj.x=ao}else{ah.y=av/am;ah.x=ak/am;au.y=(ah.y-aw.y)*(1-am);au.x=(ah.x-aw.x)*(1-am);aj.x-=au.x;aj.y-=au.y}var at={};at[aa]=ah.x+"px "+ah.y+"px";at[I]=aj.toString();U(ax.elements.preview,at)}function x(){var av=this,ap=false,au,ar,aj,ao,al;function ah(ax,aw){var ay=av.elements.preview.getBoundingClientRect(),aA=al.y+aw,az=al.x+ax;if(av.options.enforceBoundary){if(ao.top>ay.top+aw&&ao.bottom<ay.bottom+aw){al.y=aA}if(ao.left>ay.left+ax&&ao.right<ay.right+ax){al.x=az}}else{al.y=aA;al.x=az}}function ak(aw){av.elements.preview.setAttribute("aria-grabbed",aw);av.elements.boundary.setAttribute("aria-dropeffect",aw?"move":"none")}function aq(aB){var aC=37,aD=38,ax=39,az=40;if(aB.shiftKey&&(aB.keyCode===aD||aB.keyCode===az)){var aA;if(aB.keyCode===aD){aA=parseFloat(av.elements.zoomer.value)+parseFloat(av.elements.zoomer.step)}else{aA=parseFloat(av.elements.zoomer.value)-parseFloat(av.elements.zoomer.step)}av.setZoom(aA)}else{if(av.options.enableKeyMovement&&(aB.keyCode>=37&&aB.keyCode<=40)){aB.preventDefault();var ay=aw(aB.keyCode);al=ad.parse(av.elements.preview);document.body.style[m]="none";ao=av.elements.viewport.getBoundingClientRect();ai(ay)}}function aw(aE){switch(aE){case aC:return[1,0];case aD:return[0,1];case ax:return[-1,0];case az:return[0,-1]}}}function ai(ay){var ax=ay[0],aw=ay[1],az={};ah(ax,aw);az[I]=al.toString();U(av.elements.preview,az);K.call(av);document.body.style[m]="";T.call(av);C.call(av);aj=0}function am(aw){if(aw.button!==undefined&&aw.button!==0){return}aw.preventDefault();if(ap){return}ap=true;au=aw.pageX;ar=aw.pageY;if(aw.touches){var ax=aw.touches[0];au=ax.pageX;ar=ax.pageY}ak(ap);al=ad.parse(av.elements.preview);window.addEventListener("mousemove",at);window.addEventListener("touchmove",at);window.addEventListener("mouseup",an);window.addEventListener("touchend",an);document.body.style[m]="none";ao=av.elements.viewport.getBoundingClientRect()}function at(aG){aG.preventDefault();var az=aG.pageX,ax=aG.pageY;if(aG.touches){var aC=aG.touches[0];az=aC.pageX;ax=aC.pageY}var aA=az-au,ay=ax-ar,aB={};if(aG.type==="touchmove"){if(aG.touches.length>1){var aE=aG.touches[0];var aD=aG.touches[1];var aF=Math.sqrt((aE.pageX-aD.pageX)*(aE.pageX-aD.pageX)+(aE.pageY-aD.pageY)*(aE.pageY-aD.pageY));if(!aj){aj=aF/av._currentZoom}var aw=aF/aj;P.call(av,aw);H(av.elements.zoomer);return}}ah(aA,ay);aB[I]=al.toString();U(av.elements.preview,aB);K.call(av);ar=ax;au=az}function an(){ap=false;ak(ap);window.removeEventListener("mousemove",at);window.removeEventListener("touchmove",at);window.removeEventListener("mouseup",an);window.removeEventListener("touchend",an);document.body.style[m]="";T.call(av);C.call(av);aj=0}av.elements.overlay.addEventListener("mousedown",am);av.elements.viewport.addEventListener("keydown",aq);av.elements.overlay.addEventListener("touchstart",am)}function K(){if(!this.elements){return}var ai=this,ah=ai.elements.boundary.getBoundingClientRect(),aj=ai.elements.preview.getBoundingClientRect();U(ai.elements.overlay,{width:aj.width+"px",height:aj.height+"px",top:(aj.top-ah.top)+"px",left:(aj.left-ah.left)+"px"})}var v=h(K,500);function C(){var ah=this,aj=ah.get();if(!V.call(ah)){return}ah.options.update.call(ah,aj);if(ah.$&&typeof Prototype==="undefined"){ah.$(ah.element).trigger("update.croppie",aj)}else{var ai;if(window.CustomEvent){ai=new CustomEvent("update",{detail:aj})}else{ai=document.createEvent("CustomEvent");ai.initCustomEvent("update",true,true,aj)}ah.element.dispatchEvent(ai)}}function V(){return this.elements.preview.offsetHeight>0&&this.elements.preview.offsetWidth>0}function A(){var al=this,ao=1,ai={},ak=al.elements.preview,an,am=new ad(0,0,ao),aj=new a(),ah=V.call(al);if(!ah||al.data.bound){return}al.data.bound=true;ai[I]=am.toString();ai[aa]=aj.toString();ai.opacity=1;U(ak,ai);an=al.elements.preview.getBoundingClientRect();al._originalImageWidth=an.width;al._originalImageHeight=an.height;al.data.orientation=ag(al.elements.img);if(al.options.enableZoom){o.call(al,true)}else{al._currentZoom=ao}am.scale=al._currentZoom;ai[I]=am.toString();U(ak,ai);if(al.data.points.length){N.call(al,al.data.points)}else{n.call(al)}T.call(al);K.call(al)}function o(ao){var ar=this,ah=0,ap=ar.options.maxZoom||1.5,aq,at,an=ar.elements.zoomer,al=parseFloat(an.value),ak=ar.elements.boundary.getBoundingClientRect(),ai=d(ar.elements.img,ar.data.orientation),aj=ar.elements.viewport.getBoundingClientRect(),am,au;if(ar.options.enforceBoundary){am=aj.width/ai.width;au=aj.height/ai.height;ah=Math.max(am,au)}if(ah>=ap){ap=ah+1}an.min=O(ah,4);an.max=O(ap,4);if(!ao&&(al<an.min||al>an.max)){P.call(ar,al<an.min?an.min:an.max)}else{if(ao){at=Math.max((ak.width/ai.width),(ak.height/ai.height));aq=ar.data.boundZoom!==null?ar.data.boundZoom:at;P.call(ar,aq)}}H(an)}function N(ap){if(ap.length!==4){throw"Croppie - Invalid number of points supplied: "+ap}var at=this,ah=ap[2]-ap[0],aj=at.elements.viewport.getBoundingClientRect(),ai=at.elements.boundary.getBoundingClientRect(),ak={left:aj.left-ai.left,top:aj.top-ai.top},am=aj.width/ah,ar=ap[1],al=ap[0],ao=(-1*ap[1])+ak.top,aq=(-1*ap[0])+ak.left,an={};an[aa]=al+"px "+ar+"px";an[I]=new ad(aq,ao,am).toString();U(at.elements.preview,an);P.call(at,am);at._currentZoom=am}function n(){var ap=this,al=ap.elements.preview.getBoundingClientRect(),ah=ap.elements.viewport.getBoundingClientRect(),an=ap.elements.boundary.getBoundingClientRect(),ai=ah.left-an.left,ak=ah.top-an.top,ao=ai-((al.width-ah.width)/2),am=ak-((al.height-ah.height)/2),aj=new ad(ao,am,ap._currentZoom);U(ap.elements.preview,I,aj.toString())}function l(am){var ak=this,al=ak.elements.canvas,aj=ak.elements.img,ah=al.getContext("2d");ah.clearRect(0,0,al.width,al.height);al.width=aj.width;al.height=aj.height;var ai=ak.options.enableOrientation&&am||ag(aj);X(al,aj,ai)}function F(ao){var ax=this,at=ao.points,am=af(at[0]),ar=af(at[1]),au=af(at[2]),ah=af(at[3]),aj=au-am,av=ah-ar,ai=ao.circle,ak=document.createElement("canvas"),aw=ak.getContext("2d"),aq=0,an=0,al=ao.outputWidth||aj,ap=ao.outputHeight||av;ak.width=al;ak.height=ap;if(ao.backgroundColor){aw.fillStyle=ao.backgroundColor;aw.fillRect(0,0,al,ap)}if(ax.options.enforceBoundary!==false){aj=Math.min(aj,ax._originalImageWidth);av=Math.min(av,ax._originalImageHeight)}aw.drawImage(this.elements.preview,am,ar,aj,av,aq,an,al,ap);if(ai){aw.fillStyle="#fff";aw.globalCompositeOperation="destination-in";aw.beginPath();aw.arc(ak.width/2,ak.height/2,ak.width/2,0,Math.PI*2,true);aw.closePath();aw.fill()}return ak}function J(al){var ak=al.points,am=document.createElement("div"),ai=document.createElement("img"),aj=ak[2]-ak[0],ah=ak[3]-ak[1];G(am,"croppie-result");am.appendChild(ai);U(ai,{left:(-1*ak[0])+"px",top:(-1*ak[1])+"px"});ai.src=al.url;U(am,{width:aj+"px",height:ah+"px"});return am}function s(ah){return F.call(this,ah).toDataURL(ah.format,ah.quality)}function b(ai){var ah=this;return new Promise(function(aj){F.call(ah,ai).toBlob(function(ak){aj(ak)},ai.format,ai.quality)})}function i(ah){if(this.elements.img.parentNode){Array.prototype.forEach.call(this.elements.img.classList,function(ai){ah.classList.add(ai)});this.elements.img.parentNode.replaceChild(ah,this.elements.img);this.elements.preview=ah}this.elements.img=ah}function c(al,ah){var aj=this,ak,am=[],an=null,ai=w.call(aj);if(typeof(al)==="string"){ak=al;al={}}else{if(Array.isArray(al)){am=al.slice()}else{if(typeof(al)==="undefined"&&aj.data.url){A.call(aj);C.call(aj);return null}else{ak=al.url;am=al.points||[];an=typeof(al.zoom)==="undefined"?null:al.zoom}}}aj.data.bound=false;aj.data.url=ak||aj.data.url;aj.data.boundZoom=an;return z(ak,ai).then(function(at){i.call(aj,at);if(!am.length){var au=d(at);var av=aj.elements.viewport.getBoundingClientRect();var ay=av.width/av.height;var ar=au.width/au.height;var ap,az;if(ar>ay){az=au.height;ap=az*ay}else{ap=au.width;az=au.height/ay}var aq=(au.width-ap)/2;var ax=(au.height-az)/2;var ao=aq+ap;var aw=ax+az;aj.data.points=[aq,ax,ao,aw]}else{if(aj.options.relative){am=[am[0]*at.naturalWidth/100,am[1]*at.naturalHeight/100,am[2]*at.naturalWidth/100,am[3]*at.naturalHeight/100]}}aj.data.points=am.map(function(aA){return parseFloat(aA)});if(aj.options.useCanvas){l.call(aj,al.orientation)}A.call(aj);C.call(aj);ah&&ah()})}function O(ah,ai){return parseFloat(ah).toFixed(ai||0)}function Y(){var ar=this,ai=ar.elements.preview.getBoundingClientRect(),ak=ar.elements.viewport.getBoundingClientRect(),aj=ak.left-ai.left,aq=ak.top-ai.top,an=(ak.width-ar.elements.viewport.offsetWidth)/2,am=(ak.height-ar.elements.viewport.offsetHeight)/2,ah=aj+ar.elements.viewport.offsetWidth+an,ap=aq+ar.elements.viewport.offsetHeight+am,al=ar._currentZoom;if(al===Infinity||isNaN(al)){al=1}var ao=ar.options.enforceBoundary?0:Number.NEGATIVE_INFINITY;aj=Math.max(ao,aj/al);aq=Math.max(ao,aq/al);ah=Math.max(ao,ah/al);ap=Math.max(ao,ap/al);return{points:[O(aj),O(aq),O(ah),O(ap)],zoom:al,orientation:ar.data.orientation}}var g={type:"canvas",format:"png",quality:1},r=["jpeg","webp","png"];function M(au){var ar=this,al=Y.call(ar),ah=R(B(g),B(au)),ak=(typeof(au)==="string"?au:(ah.type||"base64")),at=ah.size||"viewport",ap=ah.format,aq=ah.quality,ao=ah.backgroundColor,ai=typeof ah.circle==="boolean"?ah.circle:(ar.options.viewport.type==="circle"),am=ar.elements.viewport.getBoundingClientRect(),an=am.width/am.height,aj;if(at==="viewport"){al.outputWidth=am.width;al.outputHeight=am.height}else{if(typeof at==="object"){if(at.width&&at.height){al.outputWidth=at.width;al.outputHeight=at.height}else{if(at.width){al.outputWidth=at.width;al.outputHeight=at.width/an}else{if(at.height){al.outputWidth=at.height*an;al.outputHeight=at.height}}}}}if(r.indexOf(ap)>-1){al.format="image/"+ap;al.quality=aq}al.circle=ai;al.url=ar.data.url;al.backgroundColor=ao;aj=new Promise(function(av){switch(ak.toLowerCase()){case"rawcanvas":av(F.call(ar,al));break;case"canvas":case"base64":av(s.call(ar,al));break;case"blob":b.call(ar,al).then(av);break;default:av(J.call(ar,al));break}});return aj}function y(){A.call(this)}function f(aj){if(!this.options.useCanvas||!this.options.enableOrientation){throw"Croppie: Cannot rotate without enableOrientation && EXIF.js included"}var ah=this,ai=ah.elements.canvas;ah.data.orientation=E(ah.data.orientation,aj);X(ai,ah.elements.img,ah.data.orientation);T.call(ah,true);o.call(ah)}function k(){var ah=this;ah.element.removeChild(ah.elements.boundary);t(ah.element,"croppie-container");if(ah.options.enableZoom){ah.element.removeChild(ah.elements.zoomerWrap)}delete ah.elements}if(window.jQuery){var L=window.jQuery;L.fn.croppie=function(ak){var aj=typeof ak;if(aj==="string"){var ah=Array.prototype.slice.call(arguments,1);var ai=L(this).data("croppie");if(ak==="get"){return ai.get()}else{if(ak==="result"){return ai.result.apply(ai,ah)}else{if(ak==="bind"){return ai.bind.apply(ai,ah)}}}return this.each(function(){var al=L(this).data("croppie");if(!al){return}var am=al[ak];if(L.isFunction(am)){am.apply(al,ah);if(ak==="destroy"){L(this).removeData("croppie")}}else{throw"Croppie "+ak+" method not found"}})}else{return this.each(function(){var al=new q(this,ak);al.$=L;L(this).data("croppie",al)})}}}function q(ai,aj){if(ai.className.indexOf("croppie-container")>-1){throw new Error("Croppie: Can't initialize croppie more than once")}this.element=ai;this.options=R(B(q.defaults),aj);if(this.element.tagName.toLowerCase()==="img"){var ah=this.element;G(ah,"cr-original-image");S(ah,{"aria-hidden":"true",alt:""});var al=document.createElement("div");this.element.parentNode.appendChild(al);al.appendChild(ah);this.element=al;this.options.url=this.options.url||ah.src}D.call(this);if(this.options.url){var ak={url:this.options.url,points:this.options.points};delete this.options.url;delete this.options.points;c.call(this,ak)}}q.defaults={viewport:{width:100,height:100,type:"square"},boundary:{},orientationControls:{enabled:true,leftClass:"",rightClass:""},resizeControls:{width:true,height:true},customClass:"",showZoomer:true,enableZoom:true,enableResize:false,mouseWheelZoom:true,enableExif:false,enforceBoundary:true,enableOrientation:false,enableKeyMovement:true,update:function(){}};q.globals={translate:"translate3d"};R(q.prototype,{bind:function(ai,ah){return c.call(this,ai,ah)},get:function(){var ai=Y.call(this);var ah=ai.points;if(this.options.relative){ah[0]/=this.elements.img.naturalWidth/100;ah[1]/=this.elements.img.naturalHeight/100;ah[2]/=this.elements.img.naturalWidth/100;ah[3]/=this.elements.img.naturalHeight/100}return ai},result:function(ah){return M.call(this,ah)},refresh:function(){return y.call(this)},setZoom:function(ah){P.call(this,ah);H(this.elements.zoomer)},rotate:function(ah){f.call(this,ah)},destroy:function(){return k.call(this)}});return q}));